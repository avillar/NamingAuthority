
1 
Copyright © 2014 Open Geospatial Consortium 

Open Geospatial Consortium  
Submission Date: 2014-11-20 

Approval Date:   2014-09-14 

Publication Date:   2014-12-30  

External identifier of this OGC® document:  http://www.opengis.net/doc/PER/waterml2.0/part2-ie-results 

Internal reference number of this OGC® document:  14-114r1   

Category: Engineering Report 

Editor:   Peter Taylor  

 

 

 

WaterML2.0 part 2 – rating tables, gauging observations and 
cross-sections: Interoperability Experiment Results 

 

Copyright notice 

Copyright © 2014 Open Geospatial Consortium 
To obtain additional rights of use, visit http://www.opengeospatial.org/legal/. 

 

Warning 

This document is not an OGC Standard. This document is an OGC Public Engineering 
Report created as a deliverable in an OGC Interoperability Initiative and is not an 
official position of the OGC membership. It is distributed for review and comment. It is 
subject to change without notice and may not be referred to as an OGC Standard. 
Further, any OGC Engineering Report should not be referenced as required or 
mandatory technology in procurements. 

Document type:    OGC® Public Engineering Report 
Document subtype:     
Document stage:    Approved for public release 
Document language:  English 



2 
Copyright © 2014 Open Geospatial Consortium 

License Agreement 

Permission is hereby granted by the Open Geospatial Consortium, ("Licensor"), free of charge and subject to the terms set forth below, 
to any person obtaining a copy of this Intellectual Property and any associated documentation, to deal in the Intellectual Property 
without restriction (except as set forth below), including without limitation the rights to implement, use, copy, modify, merge, publish, 
distribute, and/or sublicense copies of the Intellectual Property, and to permit persons to whom the Intellectual Property is furnished to 
do so, provided that all copyright notices on the intellectual property are retained intact and that each person to whom the Intellectual 
Property is furnished agrees to the terms of this Agreement. 

If you modify the Intellectual Property, all copies of the modified Intellectual Property must include, in addition to the above 
copyright notice, a notice that the Intellectual Property includes modifications that have not been approved or adopted by LICENSOR. 

THIS LICENSE IS A COPYRIGHT LICENSE ONLY, AND DOES NOT CONVEY ANY RIGHTS UNDER ANY PATENTS 
THAT MAY BE IN FORCE ANYWHERE IN THE WORLD. 

THE INTELLECTUAL PROPERTY IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR 
PURPOSE, AND NONINFRINGEMENT OF THIRD PARTY RIGHTS. THE COPYRIGHT HOLDER OR HOLDERS INCLUDED 
IN THIS NOTICE DO NOT WARRANT THAT THE FUNCTIONS CONTAINED IN THE INTELLECTUAL PROPERTY WILL 
MEET YOUR REQUIREMENTS OR THAT THE OPERATION OF THE INTELLECTUAL PROPERTY WILL BE 
UNINTERRUPTED OR ERROR FREE. ANY USE OF THE INTELLECTUAL PROPERTY SHALL BE MADE ENTIRELY AT 
THE USER’S OWN RISK. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR ANY CONTRIBUTOR OF 
INTELLECTUAL PROPERTY RIGHTS TO THE INTELLECTUAL PROPERTY BE LIABLE FOR ANY CLAIM, OR ANY 
DIRECT, SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES WHATSOEVER RESULTING 
FROM ANY ALLEGED INFRINGEMENT OR ANY LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF 
CONTRACT, NEGLIGENCE OR UNDER ANY OTHER LEGAL THEORY, ARISING OUT OF OR IN CONNECTION WITH 
THE IMPLEMENTATION, USE, COMMERCIALIZATION OR PERFORMANCE OF THIS INTELLECTUAL PROPERTY. 

This license is effective until terminated. You may terminate it at any time by destroying the Intellectual Property together with all 
copies in any form. The license will also terminate if you fail to comply with any term or condition of this Agreement. Except as 
provided in the following sentence, no such termination of this license shall require the termination of any third party end-user 
sublicense to the Intellectual Property which is in force as of the date of notice of such termination. In addition, should the Intellectual 
Property, or the operation of the Intellectual Property, infringe, or in LICENSOR’s sole opinion be likely to infringe, any patent, 
copyright, trademark or other right of a third party, you agree that LICENSOR, in its sole discretion, may terminate this license 
without any compensation or liability to you, your licensees or any other party. You agree upon termination of any kind to destroy or 
cause to be destroyed the Intellectual Property together with all copies in any form, whether held by you or by any third party. 

Except as contained in this notice, the name of LICENSOR or of any other holder of a copyright in all or part of the Intellectual 
Property shall not be used in advertising or otherwise to promote the sale, use or other dealings in this Intellectual Property without 
prior written authorization of LICENSOR or such copyright holder. LICENSOR is and shall at all times be the sole entity that may 
authorize you or any third party to use certification marks, trademarks or other special designations to indicate compliance with any 
LICENSOR standards or specifications. This Agreement is governed by the laws of the Commonwealth of Massachusetts. The 
application to this Agreement of the United Nations Convention on Contracts for the International Sale of Goods is hereby expressly 
excluded. In the event any provision of this Agreement shall be deemed unenforceable, void or invalid, such provision shall be 
modified so as to make it valid and enforceable, and as so modified the entire Agreement shall remain in full force and effect. No 
decision, action or inaction by LICENSOR shall be construed to be a waiver of any rights or remedies available to it. 

  



3 
Copyright © 2014 Open Geospatial Consortium 

Contents	  
1.	   Scope ........................................................................................................................... 7	  

2.	   References ................................................................................................................... 7	  

3.	   Terms and Definitions ................................................................................................. 8	  

3.1	   Conversion ........................................................................................................... 8	  

3.2	   Control .................................................................................................................. 8	  

3.3	   Rating ................................................................................................................... 8	  

3.4	   Rating curve ......................................................................................................... 9	  

3.5	   Rating table .......................................................................................................... 9	  

3.6	   Stage ..................................................................................................................... 9	  

3.7	   Discharge .............................................................................................................. 9	  

3.8	   Gauging/ Gauging Observation (Gaging US) ...................................................... 9	  

3.9	   Cross-section ........................................................................................................ 9	  

4.	   Objectives of the Interoperability Experiment ............................................................ 9	  

4.1	   Technical objectives ........................................................................................... 10	  

4.2	   Domain objectives .............................................................................................. 10	  

5.	   Summary of key findings .......................................................................................... 10	  

6.	   Scenarios ................................................................................................................... 11	  

6.1	   Scenario 1 – Inter agency exchange (Australia) ................................................. 11	  

6.2	   Scenario 2 – River Modeling and Flood forecasting (United States) ................ 12	  

6.3	   Scenario 3 – Public data publishing (United Kingdom) .................................... 13	  

6.4	   Scenario 4 – Validation and Visualization ......................................................... 14	  

7.	   Requirements ............................................................................................................ 15	  

7.1	   Ratings ................................................................................................................ 16	  

7.2	   Gaugings ............................................................................................................. 16	  



4 
Copyright © 2014 Open Geospatial Consortium 

7.3	   Cross-sections ..................................................................................................... 16	  

7.4	   Range periods ..................................................................................................... 16	  

8.	   Service implementation options ................................................................................ 17	  

8.1	   Services considered ............................................................................................ 17	  

8.1.1	   Sensor Observation Service (SOS) ............................................................. 17	  

8.1.2	   Web Feature Service (WFS) ....................................................................... 17	  

8.1.3	   Representational State Transfer (REST) Service ........................................ 17	  

8.2	   Implementation design ....................................................................................... 17	  

8.2.1	   Ratings - Conversions, ConversionGroups and RangeValues in SOS ....... 17	  

8.2.2	   Gaugings in SOS ......................................................................................... 18	  

8.2.3	   Gaugings in WFS ........................................................................................ 19	  

8.2.4	   Cross-sections in SOS/WFS ....................................................................... 19	  

8.3	   Summary ............................................................................................................ 20	  

8.4	   OGC service deployment ................................................................................... 21	  

8.5	   RESTful service implementation ....................................................................... 21	  

8.6	   Recommended service implementation ............................................................. 22	  

9.	   The IE information model ......................................................................................... 22	  

9.1	   Gaugings implementation model ....................................................................... 24	  

9.2	   Conversions implementation model ................................................................... 25	  

9.3	   Vocabularies ....................................................................................................... 26	  

10.	   Scenario Implementations ...................................................................................... 26	  

10.1	   Australian scenario – cross agency exchange ................................................. 26	  

10.2	   US Scenario .................................................................................................... 28	  

10.3	   UK Scenario ................................................................................................... 28	  

10.4	   Validation and Visualisation .......................................................................... 29	  



5 
Copyright © 2014 Open Geospatial Consortium 

10.4.1	   Visualisation client ...................................................................................... 30	  

11.	   JSON encoding ...................................................................................................... 32	  

11.1	   Standard JSON response headers ................................................................... 32	  

11.2	   JSON Schema ................................................................................................. 33	  

12.	   Challenges .............................................................................................................. 34	  

12.1	   Mapping to internal data structures ................................................................ 34	  

12.1.1	   Identifiers .................................................................................................... 34	  

12.2	   Handling large service responses ................................................................... 35	  

12.3	   Separation of information model and web service ......................................... 35	  

12.3.1	   Optimizing API return collections .............................................................. 35	  

13.	   Results .................................................................................................................... 38	  

13.1	   Comparison with OGC RESTful services ...................................................... 41	  

 

  



6 
Copyright © 2014 Open Geospatial Consortium 

 

i. Abstract 
Part 1 of WaterML2.0 covers exchange of hydrological time-series data, the 
observational processes used to generate them, and information related to the monitoring 
points (stations/sites) where time-series data are typically collected. WaterML2.0 Part 2, 
is a candidate standard that defines how to exchange rating tables, gauging observations 
and cross-sections in an interoperable manner.  

This engineering report outlines the design and results of an OGC Interoperability 
Experiment (IE) that implemented and tested the current WaterML2.0 part 2 information 
model. The OGC IE experiment ran was conducted from November 2013 to August 
2014. The use case for the IE involved exchange of data in three scenarios in Australia, 
US and the UK.  

This report describes the software requirements, design, deployments and challenges 
faced by the experiment. The results were used to improve the WaterML2.0 part 2 
information model and provided the basis for the formation of an OGC Standards 
Working Group (SWG) in August 2014. This SWG is responsible for formalization of the 
candidate OGC standard, for submission in 2015.  

ii. Keywords 
The following are keywords to be used by search engines and document catalogues. 

Ogc, ogc document, WaterML2.0, rating tables, rating curves, gaugings, hydrometric 
data exchange.  

iii. Submitting organizations 
The following organizations submitted this Document to the Open Geospatial 
Consortium (OGC):  

• Commonwealth Scientific and Industrial Research Organisation, Australia 
(CSIRO) 

• Bureau of Meteorology, Australia (BOM) 
• Aquatic Informatics, Canada 
• KISTERS, Germany & Australia 
• Centre for Ecology and Hydrology, United Kingdom (CEH) 
• Unites States Geological Survey, United States of America (USGS) 

iv. Submitters 
All questions regarding this submission should be directed to the editor or the submitters: 

Name Affiliation 



7 
Copyright © 2014 Open Geospatial Consortium 

Peter Taylor CSIRO 
Paul Sheahan BOM 
Stuart Hamilton & 
Brian Gouge 

Aquatic Informatics 

Peter Heweston Kisters Australia 
Matthew Fry &  
Oliver Swain 

CEH 

Dave Briar USGS 

1. Scope 

This engineering report outlines the requirements, implementation, results and challenges 
of the WaterML2.0 part 2 (hereafter referred to as ‘part 2’) Interoperability Experiment. 
The report describes the web services used in the IE, the encodings of the part 2 
information model, the vocabularies used, and any software clients developed.  

The report does not cover a full description of the current part 2 information model; this 
is available as an OGC discussion paper1. 

2. References 

The following normative documents contain provisions that, through reference in this 
text, constitute provisions of this document. For dated references, subsequent 
amendments to, or revisions of, any of these publications do not apply. For undated 
references, the latest edition of the normative document referred to applies. 

OGC 08-131r3 – The Specification Model – A Standard for Modular Specification 

ISO 19103:2005 – Conceptual Schema Language 

ISO 8601- Data elements and interchange formats – Information interchange – 
Representation of dates and times 

OGC Abstract Specification Topic 20  – Observations and Measurements (aka ISO 
19156:2011) 

OGC Abstract Specification Topic 2  – Spatial Referencing by Coordinates (aka ISO 
19111:2007) 

                                                
1WaterML2.0 - part 2: Ratings, Gaugings and Sections Discussion Paper:  
https://portal.opengeospatial.org/files/?artifact_id=54423 



8 
Copyright © 2014 Open Geospatial Consortium 

OGC Abstract Specification Topic 6  – Schema for Coverage geometry and functions 
(aka ISO 19123:2005) 

OGC Abstract Specification Topic 11  – Geographic information — Metadata (aka ISO 
19115:2003) 

OGC 07-036 Geography Markup Language (aka ISO 19136:2007) 

OGC WaterML2.0 part 1 – timeseries. OGC 10-126r3. 
www.opengis.net/standards/waterml  

OGC Observations and Measurements v2.0 OGC Document 10-004r1 
http://www.opengis.net/doc/AS/Topic20 (also published as ISO/DIS 19156:2010, 
Geographic information — Observations and Measurements) 

OGC SWE Common Data Model Encoding Standard v2.0 OGC Document 08-094r1 
http://www.opengis.net/doc/IS/SWECommon/2.0  

Unified Code for Units of Measure (UCUM) – Version 1.8, July 2009 

Unified Modeling Language (UML). Version 2.3. May 2010. 

Extensible Markup Language (XML) – Version 1.0 (Fourth Edition), August 2006 

XML Schema – Version 1.0 (Second Edition), October 2004 

3. Terms and Definitions 

The WaterML2.0 part 2 information model covers three core concepts: rating 
curves/tables, gauging observations and cross-sections. For the purposes of this 
document, the following terms and definitions apply. 

3.1 Conversion 
A conversion defines the relationship between two physical properties using an equation, 
x-y point table or other form. For example, a stage-discharge conversion defined by a 
rating table. 

3.2 Control 
Physical properties of a cross-section or a reach of an open channel, either natural or 
artificial, that govern the relation between stage and discharge at a location in the open 
channel. (source: Australian Water Information Dictionary: 
http://www.bom.gov.au/water/awid/search.shtml?q=control&p=)  

3.3 Rating 
A relationship between variables (phenomenon). (Source : Australian Water Information 
Dictionary : http://www.bom.gov.au/water/awid/search.shtml?q=rating&p= 



9 
Copyright © 2014 Open Geospatial Consortium 

The Rating is used to enable the computation of derived observations for a phenomenon 
that is not easily monitored, from a related phenomenon that is readily monitored.  

3.4 Rating curve 
A drawn curve showing the relation between gauge height and discharge of a stream at a 
given gauging station.  (source: USGS glossary)  
This is a common definition in a Hydrological context, often described as the discharge 
rating curve. However is also accepted that a rating curve is generalised as the graphical 
representation of the relationship between two phenomena.  

3.5 Rating table 
Any table showing the relation between two mutually dependent quantities or variables 
over a given range of magnitude, e.g., a table showing the relationship between the stage 
in a reservoir and its volume. (Source: Australian Water Information Dictionary: 
http://www.bom.gov.au/water/awid/search.shtml?q=rating+table&p=) 

3.6 Stage 
The water level, typically measured at a water-monitoring site. Synonym: gauge height. 

(Source: Australian Water Information Dictionary: 
http://www.bom.gov.au/water/awid/id-1913.shtml) 

3.7 Discharge 
Volume of liquid flowing through a cross-section in a unit time. (Source: Australian 
Water Information Dictionary: 
http://www.bom.gov.au/water/awid/search.shtml?q=discharge&p=) 

3.8 Gauging/ Gauging Observation (Gaging US) 
Physical measurement of instantaneous streamflow (Discharge) to develop the stage-
discharge relationship. (Source: Australian Water Information Dictionary: 
http://www.bom.gov.au/water/awid/search.shtml?q=gauging&p=) 

3.9 Cross-section 
The section of a stream is the section normal to the mean direction of flow bounded by 
the free surface and wetted perimeter of the stream. (Source: Australian Water 
Information Dictionary: http://www.bom.gov.au/water/awid/search.shtml?q=cross-
section&p=) 

 

4. Objectives of the Interoperability Experiment 

The following is provided as background. The goal of the WaterML2.0 part 2 
Interoperability Experiment (IE) was to test the part 2 information model using three data 
exchange scenarios running in Australia, the US and UK. While each scenario involves 



10 
Copyright © 2014 Open Geospatial Consortium 

different operators, the ultimate goals can be defined within the context of either a 
technical or domain challenge.  

4.1 Technical objectives  
1. Test and progress development of the draft WaterML2.0 part 2 information model 

towards being an OGC standard;  

2. Test compatibility of the draft WaterML2.0 part 2 model with existing OGC 
services such as WFS and SOS, and explore options for RESTful services; 

3. Test encodings using standard GML/XML, and investigate alternative encodings 
such as JSON.  

4.2 Domain objectives  
1. Develop standardised approaches to the sharing of Ratings, Gaugings and 

Sections to enable: 

a. Assessment of data fitness for purpose 

b. Timely flood operations with correct rating data 

c. Review of discharge record quality 

d. Calculation of derived phenomenon 

e. Support hydrological modeling activities for the water resource 
assessment, inundation and forecasting.  

2. Advance machine-machine exchange processes between the Australian Bureau of 
Meteorology and Australian water agencies;  

3. Enhance the exchange of ratings between USGS, NWS and the US Army Corps 
of Engineers (USACE);  

4. Provide web-accessible ratings and gaugings data within the UK National River 
Flow Archive’s Peak Flows dataset. 

5. Summary of key findings 

This section provides a quick overview of the key recommendations and findings 
resulting from the Interoperability Experiment. 

Recommendation: The Sensor Observation Service (SOS) is the recommended OGC 
web service for exchange of Gauging Observations and Section Observations data. 



11 
Copyright © 2014 Open Geospatial Consortium 

Recommendation: The Web Feature Service (WFS) is the recommended OGC web 
service for exchange of Conversion (Rating) Tables and Range Values.  

IE Implementation Decision: The IE participants chose to implement a RESTful web 
service with JSON encodings for the operation of the IE. This was done to reduce 
complexity of implementation of both a SOS (with a profile) and WFS (with an 
application schema). For the participants unfamiliar with these specifications, the 
estimated effort was higher than participants could commit to. It was noted however that 
there are drawbacks from this approach – including lack of common service catalog 
approaches, common response headers and immaturity of schema definitions. See section 
8.6 for details.  

Finding: JSON Schema could be produced from the WaterML2.0 part 2 UML model 
using the ShapeChange tool. The mappings of OGC base types, such as those provided 
by GML, are not yet fully described. A formalized description of the UML to JSON 
Schema mapping rules would be an important step towards use and validation of JSON.  

Finding: A recommendation from OGC on standardized JSON headers would be a good 
starting point to allow common JSON encodings across services. See section 11 for 
details.  

Finding: A recommendation from OGC on common capabilities/service description 
documents for RESTful services would help in reducing divergence of future RESTful 
services within OGC.  

6. Scenarios 

The following section describes the scenarios used in the Interoperability Experiment. 

6.1 Scenario 1 – Inter agency exchange (Australia) 
This Australian scenario involves data exchange between five organizations: 

Data suppliers: Tasmanian Department of Primary Industries, Parks and Wildlife 
(DPIPWE), NSW Office of Water 

Data consumers: Bureau of Meteorology, Murray Darling Basin Authority 
(MDBA), CSIRO, Victorian Department of Environment & Primary Industries 
(DEPI) 

The Bureau receives hydrological data from water agencies within Australia, but there is 
no web-service access to allow ad-hoc or dynamic requests for these data. The IE 
provided an exemplar of how this may occur for ratings and gaugings.  

There are additional exchange scenarios that are likely once services have been 
established. For example, the MDBA may also retrieve ratings from NSW, Victoria, 
Queensland and South Australia.  



12 
Copyright © 2014 Open Geospatial Consortium 

The major interoperability challenges in this scenario include: 

• Representation of rating tables in a consistent form. Each agency describes 
rating tables differently, without consistent semantics for the core domain 
concepts.  

• Different vocabularies. There are no agreed on national or international 
standards for codes and vocabularies within Australia for terms such as data 
quality, observed properties and so on. The Water Data Transfer Format (WDTF) 
used by the Bureau to ingest data from water agencies provides some precedent, 
and may be re-used for the purposes of the IE.  

• No web-service access. There are currently no means for accessing rating and 
gauging data over the web, outside of generated HTML or PDF reports.  

 

Figure 1 shows the setup of the exchange in this scenario.  

 

Figure 1 - Australian exchange scenario 

6.2 Scenario 2 – River Modeling and Flood forecasting (United States) 
The US-based scenario involves transfer of data between the USGS’s National Water 
Information System (NWIS), the National Weather Service (NWS), and the US Army 
Corps of Engineers (USACE). NWS requires the most up to date rating tables and 



13 
Copyright © 2014 Open Geospatial Consortium 

gaugings to run flood-forecasting models. The USACE also requires these data to 
manage reservoirs and maintain navigable waterways nationwide.  There is current rating 
table exchange occurring between the three agencies. There are plans to improve this 
exchange especially in light of the USGS’ adoption of new commercially developed data-
processing software which does not support the existing rating-exchange format. The 
OGC WaterML2/0 IE was identified as a potential way to prototype new sharing 
arrangements. Figure 2 shows the exchange scenario.  

Staff from the National Weather Service have conducted a preliminary review of the 
WaterML2 Part2 encodings and have just recently identified a project to begin work on a 
client, however, neither they nor the US Army Corps of Engineers implemented a client 
in time for this IE.   

Figure 2 shows the setup of the exchange in this scenario. 

 

Figure 2 - US exchange scenario 

6.3 Scenario 3 – Public data publishing (United Kingdom) 
The UK scenario involves a publishing use case in which the Center for Ecology and 
Hydrology provided open data access for major UK flow monitoring sites. Existing 
JSON web-services exist for creation of web-pages, but these are not consumed by other 



14 
Copyright © 2014 Open Geospatial Consortium 

clients. Increased data sharing between agencies and development of complex clients will 
benefit the adoption of standards-based web-services. A CSIRO web-client was used to 
show how a standards-based client can consume multiple WaterML2.0 data services.  

• Interoperable client - Web client accessing different implementations of the 
same service.   

Providing consistent Open Data. The simple act of making data available (open) is a 
good step towards improved data access. Further, providing data in a common, well-
described format enhances a community’s ability to share tools and experiences. 

Figure 3 shows the setup of the UK exchange in this scenario. 

 

 

Figure 3 - UK exchange scenario 

 

6.4 Scenario 4 – Validation and Visualization 
While each scenario as described above has its individual interoperability challenges, 
there is an over-arching general validation and visualization scenario that ensures 



15 
Copyright © 2014 Open Geospatial Consortium 

consistent use of the WaterML2.0 part 2 information model and provided a 
demonstration of interoperability across services.  

Figure 4 shows how a cross-agency client provides access and visualization across the 
services used for this IE. This client relies on implementations being consistent in the 
implementation of the WaterML2.0 part 2 information model and web services. The 
details of the validation implementation are outlined below.  

Figure 3 shows the setup for validation and visualisation using the cross service 
integration client. 

 

 

Figure 4 - Cross-service visualisation 

7. Requirements 

The requirements for data exchange were developed through iterative analysis of the 
exchange scenarios by the participating organizations of this IE. These requirements have 
been reviewed and refined into core requirements that were implemented to ensure a 
successful IE. Other requirements were classified as desirable.  



16 
Copyright © 2014 Open Geospatial Consortium 

7.1 Ratings 
ID Query Parameters Returns 

R1 Get latest rating MP ID Single rating 

R2 Get rating periods MP ID, rating group ID Collection of rating periods 

R3 Get rating table X, Y, Z MP ID, rating IDs Collection of rating tables 

R4 Has the latest rating changed 
since this date? 

MP ID, Date Last change date 

R5 Has the rating period 
changed since this date? 

MP ID, Date, 
paramFrom/To 

Last change date 

R6 Have these ratings X, Y, Z 
changed since this date 

MP ID, Date Collection of change dates to 
rating IDs 

R7 List all the paramFrom/To 
combinations 

MP ID Collection of paramFrom/To 
combinations (i.e. rating groups) 

7.2 Gaugings 
ID Query Parameters Returns 

G1 Get the latest gauging MP ID Single gauging observation 

G2 Get gauging X, Y, Z MP ID, gauging IDS Collection of gauging observations 

G3 Get gaugings since this date MP ID, date Collection of gauging observations 

G4 Get all From/To combinations MP ID Collection of paramFrom/To combinations 

7.3 Cross-sections 

ID Query Parameters Returns 

CS2 Get cross-section after this date MP ID, date Collection of cross-sections 

CS3 Get all cross-section identifers MP ID Collection of cross-sections 

IDs/references 
 

7.4 Range periods 
ID Query Parameters Returns 

RP1 Get all range periods MP ID Collection of range periods 

RP2 Get range table X, Y MP ID, RT IDs Collection of range tables 

 



17 
Copyright © 2014 Open Geospatial Consortium 

8. Service implementation options  

This section describes the potential implementation options for encoding the 
WaterML2.0 part 2 information model using web services. There were two possible OGC 
services to encode RGS data: the Sensor Observation Service (SOS) and the Web Feature 
Service (WFS). In addition we also considered a third non-OGC RESTful service option. 

8.1 Services considered 

8.1.1 Sensor Observation Service (SOS) 
SOS is designed as an interoperable web-service for a range of observational data, from 
in-situ to mobile sensor platforms. It defines a simple core that provides basic metadata 
and access to observational data. SOS makes use of Observations & Measurements (OM) 
for data delivery encoding.  

8.1.2 Web Feature Service (WFS) 
The WFS is a flexible service for exposing feature-based views of data sets. Complex 
features, such as those resulting from WaterML2.0 part 2, can be exposed by mapping 
internal data stores (e.g. data in relational databases) to XML schema elements. It 
provides a rich query interface to access specific features based on properties and their 
values.  

8.1.3 Representational State Transfer (REST) Service 
RESTful services make use of standard HTTP calls – GET, POST, PUT, DELETE, 
OPTIONS etc – coupled with service-specific resources on which these actions may be 
performed. A summary of RESTful services is out of scope of this document; references 
are provided for further reading2.   

8.2 Implementation design 
There are a number of approaches to implementing WaterML2.0 part 2 with WFS and 
SOS. The inherent flexibility of WFS, and to a lesser degree, SOS, results in many 
possible configurations for deployment. The following section discusses how the 
WaterML2.0 part 2 information model may fit with the OGC services.  

8.2.1 Ratings - Conversions, ConversionGroups and RangeValues in SOS 
While conversions are built using individual observations, they are a derived product that 
only has a relationship to actual observations. Within WaterML2.0 part 2 they are 
modeled as individual feature types, with relationships to OM_Observation (gaugings). 
There is no directly applicable connection to the primary function of SOS, which is 
essentially delivery of OM_Observation and/or SensorML encodings.  

                                                
2 http://www.ibm.com/developerworks/webservices/library/ws-restful/ 



18 
Copyright © 2014 Open Geospatial Consortium 

These objects have a more natural fit to the WFS, given its general support for delivering 
‘feature’ data. It does however have trouble with temporal subsetting and may not be able 
to respond to ‘get latest’ type requests.  

One can argue whether conversions are ‘spatial features’, but when operating within the 
abstract OGC architecture3, most objects of importance are modeled as features. The 
OGC general feature model is analogous to object-oriented modeling in programming 
languages: model everything as a type of object (class/feature-type) and give it properties 
(attributes) and objects (features/instances) can be related to one another. 

8.2.2 Gaugings in SOS 
The GaugingObservation type defined in WaterML2.0 part 2 is a specialization of the 
OM_Observation type, as shown in Figure 5. The GaugingObservation type adds 
contextual metadata for the observation, such as observation conditions, the geometry of 
the observation line, and methods used; while also restricting the result to be a tuple that 
captures the independent variable (e.g. river level) and dependent variable (e.g. river 
flow).  

 

Figure 5 - The gauging observation core types 

The SOS service is designed to deliver and query OM_Observation data. Using a SOS to 
handle gaugings would therefore provide temporal filters on observation time, spatial 
filters for observation area, and filters for requesting conversions of specific phenomena. 
These queries cover the basic gauging requirements detailed in section 7, but further 
investigation is required to ensure the solution is adequate.  

                                                
3 OGC Abstract Specification: Topic 5 - Features. http://portal.opengeospatial.org/files/?artifact_id=29536 

«DataType»
ParameterPair

+ phenomenonFrom: ParameterCode
+ phenomenonTo: ParameterCode

«FeatureType»
ObservationContext

+ directionFromMonitoringPoint: RelativeDirectionCode [0..1]
+ distanceFromMonitoringPoint: Quantity [0..1]
+ gaugedSectionLine: GM_LineString [0..1]
+ wettedPerimeter: Quantity [0..1]
+ crossSectionArea: Quantity [0..1]
+ crossSectionWidth: Quantity [0..1]

«Type»
ObservationConditions

+ riverState: RiverStateCode [0..1]
+ controlConditions: ControlConditionCode [0..*]
+ stageEndOfObservation: Quantity [0..1]
+ stageStartOfObservation: Quantity [0..1]

OM_Process

«FeatureType»
GaugingProcess

+ metadata: NamedValue [0..*]
+ gaugingMethod: FlowMeasuringMethodCode
+ stageDeterminationMethod: StageDeterminationMethodCode [0..1]

GaugingObservationMetadata

+ approvalDate: TM_Instant [0..1]
+ status: StatusCode

«FeatureType»
GaugingObservation

+ phenomenonTime: TM_Object
+ resultTime: TM_Instant

«Type»
Gauging

+ fromValue: Quantity
+ toValue: Quantity

«FeatureType»
observation::OM_Observation

+ phenomenonTime: TM_Object
+ resultTime: TM_Instant
+ validTime: TM_Period [0..1]
+ resultQuality: DQ_Element [0..*]
+ parameter: NamedValue [0..*]

+context 0..1

+observedProperty 1

+procedure

1

+parameter

0..1

+metadata

0..1

+result 1

0..*+relatedObservation 0..*



19 
Copyright © 2014 Open Geospatial Consortium 

There is one issue relating to vocabularies: the GaugingObservation type encapsulates 
two observed properties into the OM_Observation/observedProperty attribute: the 
independent and dependent variable (as shown in the ParameterPair type in Figure 5). 
This may require the service to resolve a composite vocabulary element (e.g. a term 
capturing ‘stage-discharge’) to match a query against an individual phenomenon, such as 
stage. IE participants may be required to provide this support in the RESTful web service. 
This discussion is outlined in detail on the OGC working group page4.  

8.2.3 Gaugings in WFS 
Being a feature type, Observations are supported within WFS but there are no ‘first class’ 
queries that match the key properties of the observation type (e.g. time, phenomenon). 
The queries would need to be submitted using the OGC’s Filter Encoding standard5 that 
allows generic filtering on feature properties. While these are powerful, they have a 
relative high barrier to entry, requiring XPath6 like statements. Annex B contains 
example statements for comparison.  

8.2.4 Cross-sections in SOS/WFS 
As shown in Figure 6, cross-sections are modeled as a specialized type of 
OM_GeometryObservation as they are observations of geometric structure (i.e. 
observations that have a geometric type as their result). They therefore fit SOS given its 
ability to deliver multiple types of OM_Observation objects. As with gaugings, it would 
be possible to deliver cross-sections observations using a WFS, but the SOS provides the 
primary access functions useful for handling observational data and is thus recommended 
as the delivery mechanism for cross-sections.  

                                                
4 http://external.opengis.org/twiki_public/HydrologyDWG/RGSHandlingVocabsInService 

5 http://www.opengeospatial.org/standards/filter 

6 http://www.w3.org/TR/xpath/ 



20 
Copyright © 2014 Open Geospatial Consortium 

 

Figure 6 - Cross section observations 

8.3 Summary 
WFS, in theory, could handle all parts of WaterML2.0 part 2, although depending on the 
way time-series are structured it has been shown that it can be tricky to query time-series 
in WFS. When handling multiple features through a WFS instance, all queries are 
handled using a single GetFeature call. GetFeature parameters are used to control the 
queries for specific feature types. The OGC Filter Encoding standard is used to specify 
the semantics of the query statements. These are powerful capabilities but require a good 
understanding of filter encoding to form a valid expression. An example monitoring point 
query is explored in Annex B.  

Table 1 summarises how the above WaterML2.0 part 2 types match the service 
interfaces. 

Table 1 - Handling of WaterML2.0 part 2 types with services 

Domain concept WFS SOS RESTful 

Rating tables P  - P  

Gaugings P  PP  P  

Cross-sections P  PP  P  

 

-     Couldn’t be delivered using this service 



21 
Copyright © 2014 Open Geospatial Consortium 

P Could be delivered using this service 

PP  Provides specific calls/queries for this type of data 

 

8.4 OGC service deployment 
A potential deployment of both SOS and WFS is shown Figure 7. The key information 
objects are shown, with blue indicating WaterML2.0 part 1 and red showing part 2 
objects. This approach makes use of SOS for Gaugings and Cross-sections and WFS for 
conversions and range values.  

 

 

Figure 7 - implementation with OGC services (blue indicates WaterML2.0 part 1 
types, red is part 2)  

Recommendation: Use SOS to deliver GaugingObservations and CrossSections.  

Recommendation: Use WFS to deliver RatingTables and RangeValues 

 

8.5 RESTful service implementation 
As shown in Figure 8, the OGC web services approach can be contrasted with a RESTful 
service design. Using a RESTful approach, the WaterML2.0 part 2 information model 
defines the REST resource endpoints. Using a REST approach, the resulting service 
interface is more specific to the type of data that is being exposed. This has pros and 
cons: the API becomes more self-descriptive of the data, resulting in easier interpretation 

cmp IE Architecture

Sensor Observ ation Serv ice (SOS)

GetObservation
GetFeatureOfInterest

GetCapabilities

Timeseries

Web Feature Serv ice (WFS)

GetFeature

GetCapabilities

MonitoringPoints RatingTablesGaugingObserv ations CrossSections

Internal Datastore (e.g. Hydstra, Aquarius)

Mapping Layer

Range v alues

SOS client WFS Client

«flow»
«flow»

«flow»«flow» «flow»«flow»

«flow»«flow»«flow» «flow»«flow» «flow»



22 
Copyright © 2014 Open Geospatial Consortium 

of the service interface; but the service is more tightly bound to the information model 
and thus not reusable across information models. This key difference can be summarized 
as: A WFS implementation contains the domain-specific aspects in its response types and 
query definitions, whereas in a RESTful service puts them in the resource endpoints and 
supported query parameters.  

 

Figure 8 - RESTful service design (blue indicates WaterML2.0 part 1 types, red is 
part 2) 

8.6 Recommended service implementation 
The SOS-WFS implementation required the IE participants to understand and implement 
two additional service specifications, adding a significant level of complexity to the IE 
operation. Implementation is easier if the developers are familiar with these OGC 
services. However, in the case of the IE most participants had not implemented either 
service. Additionally, most participants are taking part through an in-kind contribution 
and thus development time is quite limited. For these reasons, the IE proceeded with a 
RESTful implementation of the information model. For operational and longer-term 
service deployments, the use of OGC may be more desirable – this would depend on 
individual organization requirements and development capacity.  

IE Implementation decision: Participants in the IE chose to primarily implement the 
RESTful web service to perform the interoperability experiment. 

9. The IE information model 

The information model used for the IE is a profile of the full WaterML2.0 part 2 model. 
A profile here refers to a model that: 

cmp REST-design

Internal Datastore (e.g. Hydstra, Aquarius)

RatingTables CrossSectionObserv ation GaugingObserv ation

Mapping Layer

MonitoringPointRange v alues Timeseries

RESTful serv ice

/Rating /CrossSection /Gauging /MonitoringPoint /Timeseries/RangeValue

REST client

«flow» «flow» «flow» «flow» «flow» «flow»



23 
Copyright © 2014 Open Geospatial Consortium 

• Adds properties required for use by the RESTful web service; 
• Restricts the cardinality of properties. 

This profile is thus an implementation-level model that captures requirements specific to 
implementation in the RESTful web service used in the IE.  

A simplified view of this model is shown in Figure 9. This view simplifies the model in a 
number of ways: 

1. Base-type attributes (e.g. id, name etc.) are shown directly in the feature types to 
improve readability; 

2. Represents objects that are encoded as by reference (i.e. through a URL) as 
directed associations; 

3. Represents inline objects as direct attributes of the type. 
4. Similar to 1, some types have been collapsed together to avoid additional sub 

properties (e.g. in the Gauging type, the from/to values are direct attributes rather 
than defined in a specific type).  
 

 

Figure 9 - The WaterML2.0 part 2 profile used in the IE 

«FeatureType»
MonitoringPoint

+ id: CharacterString
+ name: CharacterString [1..*]
+ shape: GM_Point
+ cease_to_flow: Quantity [0..1]
+ verticalDatum: CharacterString [0..1]

«FeatureType»
ConversionGroup

+ id: CharacterString
+ fullConversion: Boolean
+ paramFrom: Parameter
+ paramTo: Parameter
+ conversionPeriods: ConversionPeriod [1..*]

«DataType»
Parameter

+ id: CharacterString
+ description: CharacterString
+ external_definition: CharacterString

«FeatureType»
ConversionPeriod

+ periodStart: DateTime
+ periodEnd: DateTime

«FeatureType»
Conversion

+ id: CharacterString
+ paramFrom: Parameter
+ paramTo: Parameter
+ points: XYPoint [1..*]

«DataType»
XYPoint

+ fromValue: Quantity
+ toValue: Quantity
+ quality: Parameter

«FeatureType»
Gauging

+ id: CharacterString
+ phenomenonTime: DateTime
+ quality: Parameter
+ observedPropertyFrom: Parameter
+ observedPropertyTo: Parameter
+ fromValue: Quantity
+ toValue: Quantity

+applicableConversion

1

+featureOfInterest 1

+conversiongroup_set

0..*

+monitoringPoint1



24 
Copyright © 2014 Open Geospatial Consortium 

The model in Figure 9 is as an ‘as built’ model. Some attributes/relationships have been 
renamed from the base WaterML2.0 part 2 model. The semantics have remained the 
same. This model represents the key required classes and types that provided the 
functionality required for the IE. This model is a suitable candidate for a definition of the 
core conformance classes for the part 2 specification.  

Managing complexity is an ongoing challenge for information modeling within the 
OGC/ISO framework. An example is comparing the above described, simplified and 
implementation focused model with that of a fully expressive model, which maintains 
full relationships to its re-used/sub-typed features and types. Both approaches are useful 
and required as they serve different purposes. However, there is no formalized way to 
express the relationship between the two using the current UML profile. However the 
concept of ‘Mixins’7 is similar and could allow model views to be simplified for specific 
needs. The ShapeChange8 tool has also developed model transformations to support 
flattening a model9 and profiling10 models. The details of these functions are relatively 
recent and were not used in this IE.  

9.1 Gaugings implementation model 
Figure 10 shows the full class hierarchy for the gaugings classes. The profile types have 
collapsed parts of the relevant types into the concrete implementation types used for the 
IE.  

                                                
7 http://en.wikipedia.org/wiki/Mixin & http://shapechange.net/targets/xsd/extensions/mixin/  

8 Processing application schemas for geographic information: http://shapechange.net/ 

9 http://shapechange.net/transformations/flattener/  

10 http://shapechange.net/transformations/profiler/  



25 
Copyright © 2014 Open Geospatial Consortium 

 

Figure 10 - Gaugings and Monitoring Point class hierarchy (red = ISO19156 (O&M), blue = part 1, green = part 
2, white = IE profile types) 

9.2 Conversions implementation model 
Figure 11 shows the types used for representation of conversions (ratings, groups, points) 
and their relationship to the full WaterML2.0 part 2 model.  

Gaugings implementation profile

«FeatureType»
IE RGS Profile::Gauging

+ id: CharacterString
+ phenomenonTime: CharacterString
+ quality: Parameter
+ observedPropertyFrom: Parameter
+ observedPropertyTo: Parameter
+ fromValue: Quantity
+ toValue: Quantity

«FeatureType»
IE RGS Profile::MonitoringPoint

+ id: CharacterString
+ name: CharacterString [1..*]
+ shape: GM_Point
+ cease_to_flow: Quantity [0..1]
+ verticalDatum: CharacterString [0..1]

«DataType»
IE RGS Profile::XYPoint

+ fromValue: Quantity
+ toValue: Quantity
+ quality: Parameter

«FeatureType»
Monitoring Point::MonitoringPoint

+ descriptionReference: GenericName [0..*]
+ localDatum: CD_VerticalDatum [0..*]
+ monitoringType: GenericName [0..*]

«Type»
Gaugings::Gauging

+ fromValue: Quantity
+ toValue: Quantity

«FeatureType»
Gaugings::GaugingObserv ation

+ phenomenonTime: TM_Object
+ resultTime: TM_Instant

«FeatureType»
observ ation::OM_Observ ation

+ phenomenonTime: TM_Object
+ resultTime: TM_Instant
+ validTime: TM_Period [0..1]
+ resultQuality: DQ_Element [0..*]
+ parameter: NamedValue [0..*]

«FeatureType»
samplingPoint::

SF_SamplingPoint

«FeatureType»
spatialSamplingFeature::
SF_SpatialSamplingFeature

+ positionalAccuracy: DQ_PositionalAccuracy [0..2]

GFI_Feature

«FeatureType»
samplingFeature::
SF_SamplingFeature

+ parameter: NamedValue [0..*]
+ lineage: LI_Lineage [0..1]

+featureOfInterest

1

0..*

+relatedObservation 0..*

+featureOfInterest

1

Design

+relatedObservation 0..*

+result

1

0..*+relatedSamplingFeature 0..*



26 
Copyright © 2014 Open Geospatial Consortium 

 

Figure 11 - Conversion type hierarchy (green - part 2, white - IE implementation) 

9.3 Vocabularies 
The main required controlled vocabulary for the IE was for the definition of the observed 
properties/phenomenon (paramFrom/To). The IE participants agreed to use codes 
developed for the Australian Water Data Transfer Format (WDTF), and extend where 
required. These codes are included in Annex B.  

10. Scenario Implementations 

This section describes the implementation and deployments that occurred within each of 
the scenarios of the IE.  

10.1 Australian scenario – cross agency exchange 
The Australian scenario involved the provision of data though three Australian agencies 
and the use of the data in the CSIRO validation and visualization clients as well as the 
Bureau of Meteorology integration client.  The data provision agencies, the data types 
provided and the RGS service implementers are listed in Table 2. 

 

 

IE Conversion types

«FeatureType»
IE RGS Profile::

Conv ersion

+ id: CharacterString
+ paramFrom: Parameter
+ paramTo: Parameter

«FeatureType»
Conv ersions::Conv ersion

+ phenomenonFrom: ParameterCode
+ phenomenonTo: ParameterCode A

«FeatureType»
Conv ersions::RatingTable

+ defaultQuality: DataQualityCode

«FeatureType»
Conv ersions::Conv ersionPeriod

+ periodEnd: TM_Instant [0..1]
+ periodStart: TM_Instant
+ phasedPeriod: TM_PeriodDuration [0..1] = false

«FeatureType»
Conv ersions::Conv ersionGroup

+ domainFeatureClass: DomainFeatureClassCode [0..1]
+ fullConversion: Boolean [0..1]
+ phenomenonFromDatum: CD_VerticalDatum [0..1]

«FeatureType»
IE RGS Profile::Conv ersionGroup

+ id: CharacterString
+ fullConversion: Boolean
+ paramFrom: Parameter
+ paramTo: Parameter
+ conversionPeriods: ConversionPeriod [1..*]

«FeatureType»
IE RGS Profile::

Conv ersionPeriod

+ periodStart: DateTime
+ periodEnd: DateTime
+ points: XYPoint [1..*]

«DataType»
IE RGS Profile::XYPoint

+ fromValue: Quantity
+ toValue: Quantity
+ quality: Parameter

«Type»
Conv ersions::

TableTuple

+ fromValue: Quantity
+ toValue: Quantity

+applicableConversion

1

+applicableConversion

1

+point

2..*

+period

1..*

+sourceDefinition 0..1



27 
Copyright © 2014 Open Geospatial Consortium 

Table 2 - Summary of Data sources, scope and service providers 

Data source 
Service 
Implementer 

R
at

in
gs

 

G
au

gi
ng

s 

Se
ct

io
ns

 

T
im

e 
Se

ri
es

 

New South Wales Office of Water 
(NOW) 

CSIRO ü ü   

Victorian Department of Environment 
and Primary Industries 

Kisters, Hydstra  ü ü ü  

Tasmanian Department of Primary 
Industries, Parks, Water and 
Environment 

Aquatic Informatics,  
Aquarious 

ü ü   

BOM, Australian Water Resource 
Information System 

Kisters, Wiski    ü 

 

The BOM integration client requested ratings, gaugings and sections from the web 
services and processed the information into the Hydstra Time Series Data Management 
System. Additionally, a WaterML2.0 part 1 compliant Sensor Observation Service was 
used to retrieve time-series for comparison of gaugings against relevant hydrographs. The 
Hydstra system was used to inspect and quality assure ratings, using gaugings and 
sections. The system also produced derived flow values using ratings and time series. 

Planning for the IE indicated that other exchange scenarios are likely and include: 

• The Murray Darling Basin Authority (MDBA) retrieving ratings from NOW.  
• NSW Hydro power operators retrieving data from NOW 
• Other inter-agency transfers.  

These exchanges are likely to begin once an OGC standard is completed  and 
implementations are available for production.  



28 
Copyright © 2014 Open Geospatial Consortium 

 

10.2 US Scenario 
The US scenario involved adding a new WaterML2 Part 2 compliant interface to the 
existing USGS ratings depot, which aggregates all active ratings from 45 Water Science 
Center databases nationwide and makes them available via a public-facing web service.  
The existing USGS production ratings service supports approximately 35,000 public 
requests per day primarily by the National Weather Service and US Army Corps of 
Engineers but also by various utilities, commercial interests, and academic institutions. 
The development of WaterML2.0 part 2 is important, as the USGS has begun converting 
its timeseries data processing from a legacy system developed in-house to a new 
commercial product, which does not support the old/existing rating-file format. 
Deployment of the new data-processing system is slated for late summer 2015 at which 
time the WaterML2 part 2 standard will be the only format offered to the public from the 
USGS ratings depot. 

The US scenario made use of the CSIRO validation and visualization clients. 

10.3 UK Scenario 
The UK’s Centre for Ecology and Hydrology (CEH) hosts the UK National River Flow 
Archive, which includes a national dataset of peak flow data and associated ratings. This 
data is available via web-services but only to facilitate display. Future users would be 
expected to access the web-services via clients for which a standard would be beneficial. 
The scenario involved testing the part 2 model as a mechanism for publishing data online, 

CSIRO RGS API KISTERS API Aquatic 
Informatics API

«Database»
NSW Office of Water

«Database»
Vic DEPI

«Database»
Tas DPIPWE

Bureau of Meteorology retriev al

Hydstra RatingsSensor 
Observ ation 

Serv ice

WaterML2.0 part 
1 - timeseries

«use»

«flow»

«flow»

«flow»

«flow»

«use» «use»

«flow»

«flow»



29 
Copyright © 2014 Open Geospatial Consortium 

with the goal of enabling users to explore data and understand the implications of ratings 
on flow data. An API was built on the existing service infrastructure (already contains 
some JSON APIs) to expose the WaterML2.0 part 2 API.  

Example html page: http://www.ceh.ac.uk/data/nrfa/data/peakflow.html?27080 

Example web-service: http://www.ceh.ac.uk/nrfa/json/hiflows-ratings?station=27080 

The CEH scenario made use of the CSIRO validation and visualization clients. 

Whilst the range-values aspect of the part 2 model was not implemented, it was assessed 
for applicability to the range of rating metadata (including equations and extrapolation 
information) that is often used for qualitative assessment of ratings. 

10.4 Validation and Visualisation 
The IE participants developed a validation script to allow developers to provide early and 
quick feedback on implementations. The validator was initially a standalone script11, but 
was then provided as a web page. This allowed the validator to be run quickly without 
requiring installation – this was a requirement for developers operating in constrained 
environments. The service was made available at http://waterml2.csiro.au/validator and 
uses a base URL and a test monitoring point ID that is used for subsequent calls. The 
components and operation of the validator is shown in Figure 12 and Figure 13.  

 

Figure 12 - Validation components 

 

                                                
11 https://github.com/peterataylor/WaterML2-part2-api-tester 

CSIRO RGS API USGS RGS API KISTERS API Aquatic 
Informatics API

«Database»
NSW Office of Water

«Database»
USGS NWIS

«Database»
Vic DEPI

«Database»
Tas DPIPWE

RGS Validator

Validation web site

«Database»
UK CEH

CEH API

«flow»

«use»
«use» «use»

«flow» «flow» «flow»

«use»
«use»

«flow»



30 
Copyright © 2014 Open Geospatial Consortium 

 

Figure 13 - Validation workflow 

10.4.1 Visualisation client 
A web-based visualization client was developed that made use of the core operations and 
information objects. As the services were validated, they were then made available for 
visualization in the web-client. The client is available at http://waterml2.csiro.au/rgs-
api/v1/viz/. This client allows visualization of ratings and gaugings across a selection of 
sites for each service implemented within the IE. The basic interaction between client and 
services is shown in the sequence diagram in Figure 14. 

 

Developer

Validator web
page

Validator Script RGS API

Gauging results()

TestMonitoringPoint
(URL, MP ID)

GET /monitoring-point/(MP ID)

ValidateJSON()

:MP (JSON)

ConversionGroups (JSON)

GET /gauging?monitoring-point=MP_ID()

ConversionGroup results()

ReportResults()

MP results()

ValidateJSON()

Validate(API URL, Monitoring Point ID)

Gaugings (JSON)

GET /conversion-group?monitoring-point=MP_ID()



31 
Copyright © 2014 Open Geospatial Consortium 

 

Figure 14 - Visualization client service interactions 

The service catalog shown in Figure 14 is implemented as a lightweight internal catalog 
using a set of configuration parameters. This catalog allows quick addition of new 
services and monitoring points for testing. In a more formalized architecture the service 
catalog would likely be a web service implementation, such as the OGC Catalog 
Service12, or something offering similar functionality. This would allow dynamic 
additions and general management of the service instances. A screen shot of an example 

                                                
12 http://www.opengeospatial.org/standards/cat 

User

Web Visualisation Client Service Catalog External
WaterML2.0

Service

GET /monitoring-point(MP_ID): MonitoringPoint

GetServiceDetails()

SelectPeriod()

Gaugings
()

Select MP()

SelectConversionGroup()

GET /gaugings(MP_ID):
Gauging

GET /conversion-group(MP_ID): ConversionGroup

UpdateMonitoringPointDetails()

Conversions()

SelectSourceService()

MontoringPoint()

GET /conversion(ID):
Conversion

ConversionGroupsWithPeriods
()

DisplayConversionPeriods()

PlotGaugings()

Show available MPs()

ShowConversionGroups()

PlotConversionGraph()

URL, MP IDs()



32 
Copyright © 2014 Open Geospatial Consortium 

site from the Victorian Department of Environment and Primary Industries (via 
KISTERS service implementation) is shown in Figure 15. 

 

Figure 15 - IE visualization client 

11. JSON encoding 

All of the IE participants expressed an interest in using JSON encodings for the operation 
of the IE. Given the limited time availability of participants and the relative complexity 
of the use of XML in OGC standards (as described above) the group decided to proceed 
with a JSON-based encoding of the part 2 model.  

11.1 Standard JSON response headers 
The most formalized definition of common JSON response structures appears to be 
OData13, however OData implementation does not yet appear to be widespread. Other 

                                                
13 http://www.odata.org/  



33 
Copyright © 2014 Open Geospatial Consortium 

less formalized (and simpler) options also exist14, along with others that are generally 
rolled into a RESTful service framework (e.g. Django, Ruby on Rails etc.).  

Standardisation of the JSON implementation was not an objective for the IE, and thus the 
implementation proceeded with the following guidelines: 

• Use appropriate HTTP response codes for error conditions; 
• Use a small header set, consisting of:  

o “count” – number of records returned 
o “next” – link to next set of results 
o “previous” – link to previous set of results 
o “results” – array of returned objects (as defined by the information 

model) 

11.2 JSON Schema 
JSON schema files were generated from the flattened UML (described in section 9) using 
the ShapeChange tool. The generated schema are available online: 

• http://waterml2.csiro.au/part2/json/rgs-ie/Gauging.json  
• http://waterml2.csiro.au/part2/json/rgs-ie/Conversion.json  
• http://waterml2.csiro.au/part2/json/rgs-ie/ConversionPeriod.json  
• http://waterml2.csiro.au/part2/json/rgs-ie/MonitoringPoint.json  
• http://waterml2.csiro.au/part2/json/rgs-ie/Parameter.json  
• http://waterml2.csiro.au/part2/json/rgs-ie/XYPoint.json  

JSON mappings for the common GML types are partially available using ShapeChange, 
however some need further developing and/or publication in public locations. E.g. 
http://schemas.opengis.net/gsr/1.0/point.json  

The JSON schema was not used for the initial validation due to time constraints. The first 
validator used a simple check of required elements to allow quick feedback to service 
developers.  

                                                
14 http://jsonapi.org/format/ 

http://labs.omniti.com/labs/jsend 

http://stateless.co/hal_specification.html 

 



34 
Copyright © 2014 Open Geospatial Consortium 

12. Challenges 

12.1 Mapping to internal data structures 
The part 2 information model is a generalization of a number of hydrological concepts. 
Most hydrological data management software implements a more detailed and expressive 
system for conversion of parameters. The aim of the WaterML2.0 model is to allow 
different systems to communicate ratings, gaugings and cross-sections with sufficient 
detail to allow a basic conversion to be run, or general analysis of the rating relationship 
(e.g. how many gaugings were used in its construction, how the gaugings deviate from 
existing rating(s) etc.). To fully express complex, multi-step parameter conversions, the 
information model would need to support expression of algorithms and process chains. 
This was deemed out of scope for the current information model, and given the subtleties 
and diversity of conversions is a very large task for exchange between different 
information systems.  

12.1.1 Identifiers 
Most implementations in the IE ran into the problem of mapping objects from 
WaterML2.0 for the case in which there is not an exact mapping for the concept in the 
internal system. For example, the concept of a rating group might not have an exact 
mapping. This required implementations to create a view that captures the concept and 
provides an identifier for that concept. However, this identifier would not relate to 
directly to an object, e.g. it may be compound identifier that is composed of multiple 
objects. This is generally OK for read only systems, but when a system is required to 
import and successfully parse an object, it can be difficult to unpack/relate the required 
objects. This is always a challenge when supporting a web service that is not a direct 
reflection of the internal information model.  

In some cases, components of the compound identifier were potentially subject to change 
in the underlying system, e.g. they used application or observation dates. In the instance 
of where the identifier may change, this limits the ability of exchanged data to be 
positively reconciled with the source data system.  

The objectives of WaterML2 part 2 are consistent with this limitation. There are no RGS 
requirements that require or imply the reconciliation of RGS data back to the source 
system.  

The requirements of the RGS project are an expression of common domain concepts, a 
harmonization of the participant’s knowledge, and data system capabilities. The 
definition of common domain concepts inevitably involves a loss of content fidelity 
between the interoperable model and the source data systems. This loss of fidelity in data 
content means that the interoperable WaterML2 Part2 RGS format is not suitable for 
distributed maintenance of source system records. 

The knowledge gained from this IE is that interoperable sharing of RGS information 
could be more accurately defined as dissemination, sharing without the expectation of an 
ability to reconcile returned data into the source system.  



35 
Copyright © 2014 Open Geospatial Consortium 

12.2 Handling large service responses 
The general RESTful behavior for collections is that a GET operation on a base resource 
(e.g. /monitoring-point) should return all resources available. This can result in very large 
responses. A paging mechanism was used in the IE to limit responses to a default size, 
with next/prev references provided as part of the header response. The paging pattern is 
common, and when parameterized (e.g. allowing client-specified page sizes within a 
lower/upper bound) can suit most implementation requirements.  

These collections often need to be filtered using a query against desired attribute values. 
The exact entry point into these resources and queries is dependent on the requirements 
from calling clients. For example, the monitoring-point resource provides access to all 
monitoring points. It is generally rare for a client to request a full listing of monitoring 
points, more often requesting a spatial (e.g. bounding box) or other type (e.g. all river 
gauges) of subset. This IE was not focused on the issue of discovery, as these queries are 
usually available outside of data-specific services. For this reason the IE participants 
picked a subset of monitoring points to expose in the web-client and test in retrieval tools.   

12.3 Separation of information model and web service 
Separating issues associated with the specification of the API and those of the 
information model design can be difficult. Relationships between feature types in the 
information model would suggest a link/reference between two resources in the REST 
resources; however, there is not always a direct mapping of these.  

As discussed above, the API implements a profile of the information model with certain 
restrictions. A key point here is the use of inlineOrByReference for related feature types. 
For example, the ConversionGroup feature type contains a one-to-many relationship to 
ConversionPeriods. In implementation restricting this association to always be an inline 
only relationship is useful, allowing the conversion periods to be expressed within the 
conversion group, thus minimizing the number of requests to retrieve all the conversion 
periods (some conversion groups contain many periods).  

All the types used within the IE made design decisions of inline or reference by iterating 
the development, and crucially, writing clients that used the API to determine the desired 
behavior. Early implementations contained too many links, resulting in clients having to 
make many calls to the API for basic behavior.  

12.3.1 Optimizing API return collections 
When returning collections of multiple feature types it is often desirable to remove 
duplicate properties that are constant across all the features. This is generally the case 
when a property has been specifically queried through the API. For example, when 
requesting a collection of gauging observations for a specific monitoring point, parameter 
from and parameter to, the resulting collection will only ever contain observations with 
the same properties. Moving these properties to the top-level collection to avoid repeating 
for every encoded object is desirable.  

This pattern has been addressed in the SWE Service Model standard in the 
http://www.opengis.net/spec/SWES/2.0/req/PropInheritance/Style requirement clause. 



36 
Copyright © 2014 Open Geospatial Consortium 

This outlines a ‘property inheritance mechanism’ whereby properties inherit their values 
from a parent or specific type through three rules:  

1. No inheritance – the property is not inherited at all.  
2. Replace – the sub-type values overrides any values specified by the parent type 
3. Add – the sub-type values are added to the values specified by the base type. 

Only applies to list types.  

Using this pattern defining a generic ObservationCollection type that supports defaulting 
of the key properties of the OM_Observation type is possible. An example model for this 
generic collection is shown in Figure 16.  

 

Figure 16 - Observation collection type with property inheritance 

There is an issue with the cardinality of the OM_Observation’s properties (e.g. the 
featureOfInterest property is required), so implementation using the current XML schema 
would not be compliant with the current O&M XML Schema. This is a pattern worth 
considering for handling default/override values of features in collections to remove 
redundancy.  

An example XML encoding is shown below. This example shows an example response 
that has a fixed feature of interest, observed property and procedure.  

<omcol:ObservationCollection	  gml:id="ID000">	  
	  	  	  
	  	  <gml:description>An	  example	  Observation	  Collection	  using	  property	  inheritence.</gml:description>	  
	  	  <omcol:procedure	  xlink:href="http://www.opengis.net/def/waterml/2.0/processType/Sensor"	  

«FeatureType»
ObservationCollection

+ featureOfInterest: GFI_Feature [0..1]
+ observedProperty: GF_PropertyType [0..1]
+ resultQuality: DQ_Element [0..1]
+ parameter: NamedValue [0..*]
+ metadata: MD_Metadata [0..1]
+ procedure: OM_Process [0..1]

«FeatureType»
observation::OM_Observation

+ phenomenonTime: TM_Object
+ resultTime: TM_Instant
+ validTime: TM_Period [0..1]
+ resultQuality: DQ_Element [0..*]
+ parameter: NamedValue [0..*]

0..*+relatedObservation 0..*

+member 0..*



37 
Copyright © 2014 Open Geospatial Consortium 

	  	  	  	  	  	  	  	  	  	  	  	  	  	  	  	  	  	  	  xlink:title="Flow	  meter"/>	  
	  	  <omcol:observedProperty	  xlink:href=”http://waterml2.csiro.au/rgs-­‐
api/v1/def/observedProperty/pairs/stage-­‐discharge”	  xlink:title="Stage	  to	  discharge"/>	  
	  	  <omcol:featureOfInterest	  xlink:href="http://waterml2.csiro.au/rgs-­‐api/v1/monitoring-­‐
point/419009/"	  xlink:title="Peel	  River	  At	  Tamworth"/>	  
	  	  	  
	  	  <omcol:member>	  
	  	  	  	  <om:OM_Observation	  gml:id="observation1">	  
	  	  	  	  	  	  <om:phenomenonTime>	  
	  	  	  	  	  	  	  	  <gml:TimeInstant	  gml:id="ti-­‐1">	  
	  	  	  	  	  	  	  	  	  	  <gml:timePosition>2011-­‐04-­‐14T00:00:00</gml:timePosition>	  
	  	  	  	  	  	  	  	  </gml:TimeInstant>	  
	  	  	  	  	  	  </om:phenomenonTime>	  
	  	  	  	  	  	  <om:resultTime>	  
	  	  	  	  	  	  	  	  <gml:TimeInstant	  gml:id="ti-­‐2">	  
	  	  	  	  	  	  	  	  	  	  <gml:timePosition>2011-­‐04-­‐15T00:00:00</gml:timePosition>	  
	  	  	  	  	  	  	  	  </gml:TimeInstant>	  
	  	  	  	  	  	  </om:resultTime>	  
	  	  	  	  	  	  <om:result>	  
	  	  	  	  	  	  	  	  <rgs-­‐ie:Gauging	  gml:id="gauging-­‐1">	  
	  	  	  	  	  	  	  	  	  	  <rgs-­‐ie:fromValue>	  
	  	  	  	  	  	  	  	  	  	  	  	  <swe:Quantity>	  
	  	  	  	  	  	  	  	  	  	  	  	  	  	  <swe:uom	  code="m"/>	  
	  	  	  	  	  	  	  	  	  	  	  	  	  	  <swe:value>1.1</swe:value>	  
	  	  	  	  	  	  	  	  	  	  	  	  </swe:Quantity>	  
	  	  	  	  	  	  	  	  	  	  </rgs-­‐ie:fromValue>	  
	  	  	  	  	  	  	  	  	  	  <rgs-­‐ie:toValue>	  
	  	  	  	  	  	  	  	  	  	  	  	  <swe:Quantity>	  
	  	  	  	  	  	  	  	  	  	  	  	  	  	  <swe:uom	  code="cumecs"/>	  
	  	  	  	  	  	  	  	  	  	  	  	  	  	  <swe:value>132</swe:value>	  
	  	  	  	  	  	  	  	  	  	  	  	  </swe:Quantity>	  
	  	  	  	  	  	  	  	  	  	  </rgs-­‐ie:toValue>	  
	  	  	  	  	  	  	  	  </rgs-­‐ie:Gauging>	  
	  	  	  	  	  	  </om:result>	  
	  	  	  	  </om:OM_Observation>	  
	  	  </omcol:member>	  

Using this same approach with the JSON encoding gives: 

{	  
	  	  	  	  "count":	  325,	  
	  	  	  	  "next":	  "http://waterml2.csiro.au/rgs-­‐api/v1/gauging/?monitoring-­‐point=419009&page=2",	  
	  	  	  	  "previous":	  null,	  
	  	  	  	  "featureOfInterest":	  "http://waterml2.csiro.au/rgs-­‐api/v1/monitoring-­‐point/419009/",	  
	  	  	  	  "observedPropertyFrom":	  {	  
	  	  	  	  	  	  	  	  "id":	  "100",	  
	  	  	  	  	  	  	  	  "description":	  "",	  
	  	  	  	  	  	  	  	  "external_definition":	  ""	  
	  	  	  	  },	  
	  	  	  	  "observedPropertyTo":	  {	  
	  	  	  	  	  	  	  	  "id":	  "141",	  
	  	  	  	  	  	  	  	  "description":	  "",	  
	  	  	  	  	  	  	  	  "external_definition":	  "http://neiivocab.bom.gov.au/std/water/xml/wio0.2/property/wdtf-­‐
parameters/WaterCourseDischarge_m3s"	  
	  	  	  	  },	  
	  	  	  	  "results":	  [	  
	  	  	  	  	  	  	  	  {	  
	  	  	  	  	  	  	  	  	  	  	  	  "id":	  18953,	  
	  	  	  	  	  	  	  	  	  	  	  	  "phenomenonTime":	  "2011-­‐04-­‐14T00:00:00",	  
	  	  	  	  	  	  	  	  	  	  	  	  "quality":	  12,	  
	  	  	  	  	  	  	  	  	  	  	  	  "fromValue":	  "-­‐0.31600",	  
	  	  	  	  	  	  	  	  	  	  	  	  "toValue":	  "110.02000"	  
	  	  	  	  	  	  	  	  },	  
	  	  	  	  	  	  	  	  {	  
	  	  	  	  	  	  	  	  	  	  	  	  "id":	  18868,	  
	  	  	  	  	  	  	  	  	  	  	  	  "phenomenonTime":	  "2011-­‐02-­‐15T00:00:00",	  
	  	  	  	  	  	  	  	  	  	  	  	  "quality":	  6,	  
	  	  	  	  	  	  	  	  	  	  	  	  "fromValue":	  "-­‐0.29100",	  



38 
Copyright © 2014 Open Geospatial Consortium 

	  	  	  	  	  	  	  	  	  	  	  	  "toValue":	  "138.42000"	  
	  	  	  	  	  	  	  	  },	  
	  	  	  	  	  	  	  	  	  
	  	  	  	  	  	  	  	  And	  so	  on..	  
	  	  	  	  ]	  
}	  

This greatly reduces the redundancy in the responses, particularly as the response size 
increases. An implementation of this approach is being investigated in the next version of 
the API developed in the IE.  

13. Results 

The primary goal of the IE was to test the draft WaterML2.0 part 2 information model 
against the exchange requirements defined by the RGS working group and to satisfy the 
exchange goals in each scenario. A table of the requirements defined by the group and the 
corresponding result from the IE is shown in Table 3. 

Out of the 20 requirements statements, 13 were tested within this IE. Of the 7 
requirements not tested, the functionality was available in the information model, but the 
features were not used in the implementations. This was generally because the data to test 
the feature was not available in the selected databases/information systems. For example, 
linking of the gaugings included and excluded in development of rating tables is 
commonly identified as very useful piece of metadata, however these relationships were 
not explicitly available in the test systems. The decision was to keep these relationships 
in the model, as they were identified as highly valuable and may be encoded once 
supported in the underlying software.  

Table 3 - requirements tested in the IE 

ID Requirement Supported in model? 

Implemented in 
Interoperability 

Experiment? 
Comment 

1 

Generalised conversion relationships are 
implemented rather than Stage/Flow 
only relationships. This enables 
relationships between user specified 
parameters to be defined. 

Y Y 
Yes. Existing structures are 
flexible for different parameter 
conversions.  

2 

The WML2 RGS implementation 
contains data used to complete the 
calculation of derived information. The 
definition of the process that would be 
employed to complete the transfer 
function / transformation is not currently 
in scope, my may be in scope at a later 
revision 

Y Y Yes, current implementation reflects this.  

3 Communicating the gaugings used in the 
creation of a rating is in scope. The 

Y N The information model supports 
this. However the implementations 



39 
Copyright © 2014 Open Geospatial Consortium 

gaugings if interest are: 

• Gaugings used that were taken 
in the period of application of 
the rating. 

• Gaugings not used that were 
taken in the period of 
application period of the rating. 

• Gaugings used that we taken 
outside the application period of 
the rating. - e.g. high flow 
rating. 

do not. This is because the 
underlying information systems 
currently do not track this 
information.  

4 

The inclusion of user specified user 
information that varies across the Y scale 
of a conversion is in scope. This would 
be used to give further information for 
the conversion. e.g. 
Control/Chanel/OverBankFlow 
Assessment of other sensor application 
range 

Y Y – partially.  

A test implementation of range 
values has been completed in the 
CSIRO API. This resulted in some 
changes to the information model. 
Further implementations are being 
investigated.  

5 

Ratings should always have a point table 
supplied that is expanded at a sufficient 
Y scale resolution to enable linear 
interpolation between the supplied 
points. The creator of the data file will 
choose the export resolution such that 
linear interpolation is appropriate. 

Y Y 

Yes. This has been tested and 
seems to be a reasonable solution. 
Do we need a metadata element 
indicating the resolution that they 
have been expanded at? 

6 
Ratings may have the equation that is the 
source system definition of the rating. 
This may be supplied using rgs-4. 

Y N 
Yes, supported in the information 
model. No implementation 
examples exist, yet.  

7 

A point rating table may have additional 
information that enables the source 
system to describe how it stored the 
table. 

Y N 
Yes, supported in the information 
model. No implementation 
examples exist, yet.  

8 

Reverse conversions are not supported 
implicitly by either point or equations 
conversions. Reverse conversions can be 
defined explicitly. 

Y Y 
Supported by explicitly defining 
reverse tables (e.g. a flow to stage 
table).  

9 Ratings are keyed to a Site / Point / ParameterFrom / ParameterTo. Y Y 
Yes. We changed this approach for 
a while but now key on 
MP/paramFrom/To. 

10 
When defining stage as a parameter for a 
conversion, the stage datum must be 
supplied. 

Y N 
Yes supported by information 
model. Not tested directly by the 
IE. 

11 Scope decision: The ratings being communicated are the 'Active ratings'. 
The ratings that would be applied to 

Y N/A This is a scoping/operational requirement. It could be expressed 
as a requirements statement in the 



40 
Copyright © 2014 Open Geospatial Consortium 

determine ParameterTo value. It will 
have been shift corrected and will be the 
active rating at the time. Return should 
indicate the date and time for which the 
data applied 

OGC specification, as it’s not 
really a service/encoding issue.  

12 The use of conversion transitions / phased change is in scope Y N 
Supported by information model, 
but not tested in the IE.  

13 The use of start dates for a conversions period is agreed. Y Y 
Yes, conversion period start dates 
were the primary rating period 
approach.  

14 

The use of end dates for a conversions 
period is agreed. The end dates is purely 
used for describing a gap. Rating gap 
periods can be implemented by end dates 
a or a null rating. 

Y Y Yes implemented in the IE, but no specific test for this.  

15 

Rating point quality codes will be 
implemented at the point level. A rating 
quality can be defaulted with overrides 
for each point. Rating quality can be 
applied to equations. Rating quality can 
be communicated via an input range.  

Y Y 

Yes point quality for tables is 
supported in information model 
and implemented in the IE. A 
range values approach has not yet 
been tested.  

16 

Conversions can specify Y scale range 
validated range (within rating), 
extrapolated range, beyond 
extrapolation. 

Y Y, but limited Supported in information model, not tested in IE.  

17 

There is a need for defining an input 
range purpose. An input range purpose 
should be a controlled vocabulary, the 
semantic meaning of each input range 
purpose should be defined against the 
vocabulary. Input range contents may 
vary over time, so should be referenced 
by periods of applicability. 

Y Y, but limited Partially duplicating range values requirement.  

18 
The format should enable the inclusion 
of metadata to enable the communication 
ratings approval and review process  

Y N 
Supported in the encoding, but this 
information was not conveyed 
through the exchanges.  

19 

Specific methods for the communication 
of uncertainty information are not 
currently agreed across the domain. This 
is an area of current domain 
development. The standard should be 
sufficiently extensible to enable 
incorporation when a direction is 
available. 

Y Y  

20 The conversion application period list 
may refer to a conversion table more 

Y Y  



41 
Copyright © 2014 Open Geospatial Consortium 

than once. e.g. a conversion table is 
reused 

 

Overall, this IE successfully implemented the core information model and demonstrated 
the ability to satisfy the defined requirements. The implementations led to a number of 
classes (features) and properties being renamed to better suit the domain language. When 
information modeling, there is a balance between naming classes and properties with 
specific terms vs. using more abstract terms that can generalize a particular function.  

One example of this arose during the IE. The conversion class generalizes the concept of 
converting between two parameters. The more specific term in the domain is a rating 
table, although rating tables tend to imply only conversions of river stage to flow. One of 
the main requirements was that the model must support conversions from different 
parameter types, e.g. converting storage level to storage volume, or river flow to 
sediment load.  

The range values concepts were only implemented in one of the implementations 
(CSIRO). This is largely due to it being extended functionality that provides useful 
metadata but is not crucial to the exchange of rating tables. The functionality of range 
values is powerful and captures many use cases that the working group has discussed, but 
a wider variety of implementations would require further work.  

Many of the changes that were made during the IE related to the API definition, or the 
specific encoding issues in JSON. This suggests the information model can be used to 
represent the core concepts for rating tables, gaugings and cross-section exchange. One of 
the key points of refining the model is related to how associations between feature types 
are represented, selecting the in-line or by-reference approach (where a URL is used to 
refer to objects). This encompasses one key part of service design: selecting the parts of 
an information model that will be composed together to form responses to particular 
queries.  

The approach of using RESTful services allowed participants to focus understanding and 
mapping to the WaterML2.0 part 2 model, without needing to understand multiple OGC 
specifications. However, it has been shown that the WaterML2.0 part 2 model can, with 
some work, be adapted for use with WFS and SOS.  

13.1 Comparison with OGC RESTful services 
There is some existing work within OGC on JSON encodings and RESTful APIs. 
However, there is no well-defined mapping from UML to JSON. We reviewed some 
existing discussion papers, including: 

• OGC14-009 OWS-10 OWS Context JSON Interoperability ER 
• GeoServices REST API RFC package 
• A REST binding for WFS 2.0 



42 
Copyright © 2014 Open Geospatial Consortium 

• OGC RESTful encoding of OGC Sensor Planning Service for Earth Observation 
satellite Tasking rest-sps-for-eo-tasking 

• OGC RESTful Encoding of Ordering Services Framework For Earth Observation 
Products  

One key aspect that came from this comparison is the implementation of the service 
capabilities description. The two OGC Best Practices referenced above map the existing 
OWS Common Capabilities structure to the RESTful services. This results in a base URL 
that describes the service and its resource entry points. The reference implementation of 
the WaterML2.0 part 2 service used the service description content that the 
documentation engine (Swagger15) used. This is a JSON-based service description that 
has not been standardized.  

Following the approach of the two best practices (c.f. Figure 7-1, page 42, from the 
Ordering Services Framework best practice), the following UML shows how an OWS 
service-landing page may be modeled.  

                                                
15 http://swagger.io/ 



43 
Copyright © 2014 Open Geospatial Consortium 

 

Figure 17 - Capabilities use for RESTful service 

This shows how the capabilities document would be used to reference the base entry 
point URLs for the REST API. This could be viewed as the minimal adaptation of a 
RESTful service to the existing OGC service descriptions. A more thorough review and 
guidance of RESTful services descriptions is warranted, but was out of scope for this 
work.                         

«resource»
Capabilities

+ ServiceIdentification: ServiceIdentification
+ ServiceProvider: ServiceProvider
+ Contents: OWSContents

«FeatureType»
RGS-IE::Conversion

+ id: CharacterString
+ paramFrom: Parameter
+ paramTo: Parameter

«FeatureType»
RGS-IE::ConversionGroup

+ id: CharacterString
+ fullConversion: Boolean
+ paramFrom: Parameter
+ paramTo: Parameter
+ conversionPeriods: ConversionPeriod [1..*]

«FeatureType»
RGS-IE::Gauging

+ id: CharacterString
+ phenomenonTime: CharacterString
+ quality: Parameter
+ observedPropertyFrom: Parameter
+ observedPropertyTo: Parameter
+ fromValue: Quantity
+ toValue: Quantity

«FeatureType»
RGS-IE::MonitoringPoint

+ id: CharacterString
+ name: CharacterString [1..*]
+ shape: GM_Point
+ cease_to_flow: Quantity [0..1]
+ verticalDatum: CharacterString [0..1]

«DataType»
RGS-IE::Parameter

+ id: CharacterString
+ description: CharacterString
+ external_definition: CharacterString

+monitoringPoint 1

resourceURL

resourceURL

resourceURL

+featureOfInterest

1

resourceURL

resourceURL

+conversiongroup_set 0..*



44 
Copyright © 2014 Open Geospatial Consortium 

  

Annex A: RESTful APIs 

Reference implementation (CSIRO) 

The following URLs provide examples of the WaterML2.0 part 2 encoding that was used 
as the reference implementation for the IE.  

Service API documentation URL: http://waterml2.csiro.au/rgs-api/v1/docs/  

API landing/root page: http://waterml2.csiro.au/rgs-api/v1/  

Monitoring point collection 

• HTML: http://waterml2.csiro.au/rgs-api/v1/monitoring-point/ 

• JSON: http://waterml2.csiro.au/rgs-api/v1/monitoring-point/?format=json  

Monitoring point 

• HTML: http://waterml2.csiro.au/rgs-api/v1/monitoring-point/419009 

• JSON: http://waterml2.csiro.au/rgs-api/v1/monitoring-
point/419009/?format=json  

• XML: http://waterml2.csiro.au/rgs-api/v1/monitoring-point/419009/?format=xml  

Conversion group 

• HTML: http://waterml2.csiro.au/rgs-api/v1/conversion-group/8 

• JSON: http://waterml2.csiro.au/rgs-api/v1/conversion-group/8/?format=json  

• XML: http://waterml2.csiro.au/rgs-api/v1/conversion-group/8/?format=xml  

Conversion group collection 

• HTML:   

• JSON: http://waterml2.csiro.au/rgs-api/v1/conversion-group?format=JSON  

• XML: http://waterml2.csiro.au/rgs-api/v1/conversion-group?format=XML  

Rating collection 

• HTML: http://waterml2.csiro.au/rgs-api/v1/conversion  



45 
Copyright © 2014 Open Geospatial Consortium 

• XML http://waterml2.csiro.au/rgs-api/v1/conversion/?format=xml  

• JSON: http://waterml2.csiro.au/rgs-api/v1/conversion/?format=json  

Rating table 

• HTML http://waterml2.csiro.au/rgs-api/v1/conversion?monitoring-point=419075  

• JSON: http://waterml2.csiro.au/rgs-api/v1/conversion?monitoring-
point=419075&format=json    

• XML: http://waterml2.csiro.au/rgs-api/v1/conversion/?format=xml&monitoring-
point=419075  

Gauging collection (for specific monitoring point) 

• HTML: http://waterml2.csiro.au/rgs-api/v1/gauging/?monitoring-point=419075  

• XML: http://waterml2.csiro.au/rgs-api/v1/gauging/?monitoring-
point=419075&format=xml 

• JSON: http://waterml2.csiro.au/rgs-api/v1/gauging/?monitoring-
point=419075&format=json   

Gauging 

• HTML: http://waterml2.csiro.au/rgs-api/v1/gauging/18980 

• JSON: http://waterml2.csiro.au/rgs-api/v1/gauging/18980/?format=json  

• XML: http://waterml2.csiro.au/rgs-api/v1/gauging/18980/?format=xml  

Query-based requests 

These URLs show how specific queries may be made through the API. These address 
specific requirements shown in section  

• Retrieve ratings for specific monitoring point: http://waterml2.csiro.au/rgs-
api/v1/conversion/?monitoring-point=419009  

• Retrieve latest rating table for specific monitoring point: 
http://waterml2.csiro.au/rgs-api/v1/conversion/?monitoring-point=419009&latest  

• Retrieve gauging for a monitoring point after specific date: 
http://waterml2.csiro.au/rgs-api/v1/gauging/?monitoring-point=419009&start-
date=2009-02-15  



46 
Copyright © 2014 Open Geospatial Consortium 

• Retrieve ID list of all gauging for a monitoring point: http://waterml2.csiro.au/rgs-
api/v1/gauging/?monitoring-point=419075&format=xml  

• Fully expanded list of gauging for a monitoring point: 
http://waterml2.csiro.au/rgs-api/v1/gauging/?monitoring-
point=419075&format=xml&expanded 

Kisters Implementation 

• Base URL: http://203.12.195.133/cgi/waterml2/  

UK CEH Implementation 

• Base URL: http://www.ceh.ac.uk/nrfa/rgs-api  

USGS Implementation 

• Base URL: http://staging.waterdata.usgs.gov/nwisweb/   

Aquatic Informatics implementation 

• Base URL: http://datasharing.aquaticinformatics.com/api/dpipwe/v1 

Validation client 

• http://waterml2.csiro.au/validator  

Visualisation client 

• http://waterml2.csiro.au/rgs-api/v1/viz/  

 

Annex B: WFS example queries 

This section shows example WFS queries for the same queries implemented using REST 
calls. Not all the queries worked in the prototype implementation, but they would be 
largely very similar to the listing shown.  

All monitoring points 

http://example.com/geoserver/wfs?request=GetFeature&version=1.1.0&typeName=wml2:Monito
ringPoint&outputFormat=gml32  

Monitoring point by ID 

http://example.com/geoserver/wfs?request=GetFeature&version=1.1.0&typeName=wml



47 
Copyright © 2014 Open Geospatial Consortium 

2:MonitoringPoint&outputFormat=gml32&featureid=monitoringpoint.419009  

POST queries 

Monitoring point by ID 

<?xml version="1.0" encoding="UTF-8"?> 

<GetFeature xmlns="http://www.opengis.net/wfs" 

 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 

 xmlns:fes="http://www.opengis.net/ogc" 

 xmlns:gml="http://www.opengis.net/gml/3.2" 

 xmlns:wml2="http://www.opengis.net/waterml/2.0" 

 xsi:schemaLocation="http://www.opengis.net/wfs 
../../../../Schemas/SCHEMAS_OPENGIS_NET/wfs/1.1.0/wfs.xsd"> 

  <Query typeName="wml2:MonitoringPoint"> 

   <fes:Filter> 

     <fes:GmlObjectId xmlns:gml1="http://www.opengis.net/gml" 
gml1:id="monitoringpoint.419024"></fes:GmlObjectId> 

   </fes:Filter> 

 </Query>  

</GetFeature> 

GET FEATURE using Property selection by MP ID 

<?xml version="1.0" encoding="UTF-8"?> 

<GetFeature xmlns="http://www.opengis.net/wfs" 

  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 

  xmlns:fes="http://www.opengis.net/ogc" 

  xmlns:gml="http://www.opengis.net/gml/3.2" 

  xmlns:wml2="http://www.opengis.net/waterml/2.0" 

  outputFormat="gml32" 

  xsi:schemaLocation="http://www.opengis.net/wfs 
../../../../Schemas/SCHEMAS_OPENGIS_NET/wfs/1.1.0/wfs.xsd"> 

  <Query typeName="wml2:MonitoringPoint"> 

    <PropertyName>sams:shape</PropertyName> 

    <fes:Filter> 

      <fes:GmlObjectId xmlns:gml1="http://www.opengis.net/gml" 
gml1:id="monitoringpoint.419024"></fes:GmlObjectId> 

    </fes:Filter> 



48 
Copyright © 2014 Open Geospatial Consortium 

  </Query> 

</GetFeature> 

XPath query for all MPs that have control of 'gravel'  

<?xml version="1.0" encoding="UTF-8"?> 

<GetFeature xmlns="http://www.opengis.net/wfs" 

  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 

  xmlns:fes="http://www.opengis.net/ogc" 

  xmlns:gml="http://www.opengis.net/gml/3.2" 

  xmlns:wml2="http://www.opengis.net/waterml/2.0" 

  outputFormat="gml32" 

  xsi:schemaLocation="http://www.opengis.net/wfs 
../../../../Schemas/SCHEMAS_OPENGIS_NET/wfs/1.1.0/wfs.xsd"> 

  <Query typeName="MonitoringPoint"> 

    <fes:Filter> 

      <fes:And> 

        <fes:PropertyIsEqualTo> 

          <fes:PropertyName>wml2:MonitoringPoint/sam:parameter/om:NamedValue/om:nam
e/@href</fes:PropertyName> 

          <fes:Literal>http://waterml2.csiro.au/part2/soft-
types/mp/control</fes:Literal> 

        </fes:PropertyIsEqualTo> 

      </fes:And> 

      <fes:And> 

        <fes:PropertyIsEqualTo> 

          <fes:PropertyName>wml2:MonitoringPoint/sam:parameter/om:NamedValue/om:val
ue</fes:PropertyName> 

          <fes:Literal>Gravel</fes:Literal> 

        </fes:PropertyIsEqualTo> 

      </fes:And> 

    </fes:Filter> 

  </Query> 

</GetFeature> 

Simpler xpath query  

<?xml version="1.0" encoding="UTF-8"?> 



49 
Copyright © 2014 Open Geospatial Consortium 

<GetFeature xmlns="http://www.opengis.net/wfs" 

  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 

  xmlns:fes="http://www.opengis.net/ogc" 

  xmlns:gml="http://www.opengis.net/gml/3.2" 

  xmlns:wml2="http://www.opengis.net/waterml/2.0" 

  outputFormat="gml32" 

  xsi:schemaLocation="http://www.opengis.net/wfs 
../../../../Schemas/SCHEMAS_OPENGIS_NET/wfs/1.1.0/wfs.xsd"> 

  <Query typeName="MonitoringPoint"> 

    <fes:Filter> 

      <fes:PropertyIsEqualTo> 

        <fes:PropertyName>wml2:MonitoringPoint/wml2:monitoringType/@href</fes:Pr
opertyName> 

        <fes:Literal>http://waterml2.csiro.au/part2/soft-types/mp/types/gauging-
station</fes:Literal> 

      </fes:PropertyIsEqualTo> 

    </fes:Filter> 

  </Query> 

</GetFeature> 

 

 

Annex C: Observed Property Vocabulary 

Parameter Parameter Description units Unit Name 

BatteryVoltage_V Volts V Volts 

DryAirTemperature_DegC Dry Air Temperature Cel Degrees Celsius 

ElectricalConductivityAt25C_uScm 
Electrical Conductivity @ 
25C uS/cm MicroSiemens/cm 

Evaporation_mm Evaporation mm Millimetres 

GroundWaterLevel_m Ground Water Level m Metres 

GroundWaterPressure_Kpa 
Ground Water 
Pressure_Kpa kPa KiloPascal 

Rainfall_mm Rainfall mm Millimetres 

RelativeHumidity_Perc Relative Humidity 0% Percentage 

StorageLevel_m Storage Level m Metres 

StorageSurfaceArea_m2 Storage surface area m2 Metres squared 



50 
Copyright © 2014 Open Geospatial Consortium 

StorageTransfer_MLd Inter storage transfer ML/d Megalitres/day 

StorageVolume_ML Storage Volume ML Megalitres 

StorageVolume_Perc Storage Volume 0% Percentage 

Turbidity_NTU Turbidity [NTU] 
Nephelometric 
Turbidity Units 

UrbanInflow_MLwk Urban water system inflow ML/wk Megalitres/week 

UrbanOutflow_MLwk Urban water system outflow ML/wk Megalitres/week 

UrbanSupply_MLwk Urban water system supply ML/wk Megalitres/week 

WaterCourseDischarge_m3s Water Course Discharge m3/s Cubic metres/second 

WaterCourseDischarge_MLd Water Course Discharge ML/d Megalitres/day 

WaterCourseDischarge_MLm Water Course Discharge ML/mo_c 
Megalitres/calendar 
month 

WaterCourseLevel_m Water Course Level m Metres 

WaterpH_pH pH [pH] pH 

WaterTemperature_DegC Water Temperature Cel Degrees Celsius 

WaterVolume_ML Water Volume ML Megalitres 

WetAirTemperature_DegC Wet Air Temperature Cel Degrees Celsius 

WindDirection_Deg Wind Direction deg Degrees 

WindRun_km Wind Run km Kilometres 

WindSpeed_ms Wind Speed m/s Metres/second 

NitrogenConcentration_mgL Nitrogen Concentration mg/L Milligrams/litre 

SuspendedSolids_mgL Suspended Solids mg/L Milligrams/litre 

TotalPhosphorus_mgL Total Phosphorus mg/L Milligrams/litre 

VapourPressureDeficit_mbar Vapour Pressure Deficit mbar millibars 

DownwardLongwaveExposure_Jm2 
Downward Longwave 
Exposure J/m2 

Joules per square 
metre 

DownwardLongwaveExposure95PercUncertainty_Jm2 

Downward Longwave 
Exposure 95 Percent 
Uncertainty J/m2 

Joules per square 
metre 

DownwardLongwaveExposurePeriod_s 
Downward Longwave 
Exposure Period s Seconds 

DownwardLongwaveExposureSampleCount_Count 
Downward Longwave 
Exposure Sample Count {Count} Count 

DownwardLongwaveIrradiance95PercUncertainty_Wm2 

Downward Longwave 
Irradiance 95 Percent 
Uncertainty W/m2 MicroSiemens/cm 

DownwardLongwaveIrradianceAverage_Wm2 
Downward Longwave 
Irradiance Average W/m2 MicroSiemens/cm 

DownwardLongwaveIrradianceAveragePeriod_s 
Downward Longwave 
Irradiance Average Period s Seconds 

DownwardLongwaveIrradianceSamplesAveraged_Count 

Downward Longwave 
Irradiance Samples 
Averaged {Count} Count 



51 
Copyright © 2014 Open Geospatial Consortium 

DownwardLongwaveIrradianceStandardDeviation_Wm2 

Downward Longwave 
Irradiance Standard 
Deviation W/m2 MicroSiemens/cm 

GlobalSolarExposure_Jm2 Global Solar Exposure J/m2 
Joules per square 
metre 

GlobalSolarExposure95PercUncertainty_Jm2 
Global Solar Exposure 95 
Percent Uncertainty J/m2 

Joules per square 
metre 

GlobalSolarExposurePeriod_s 
Global Solar Exposure 
Period s Seconds 

GlobalSolarExposureSampleCount_Count 
Global Solar Exposure 
Sample Count {Count} Count 

GlobalSolarIrradiance95PercUncertainty_Wm2 
Global Solar Irradiance 95 
Percent Uncertainty W/m2 MicroSiemens/cm 

GlobalSolarIrradianceAverage_Wm2 
Global Solar Irradiance 
Average W/m2 MicroSiemens/cm 

GlobalSolarIrradianceAveragePeriod_s 
Global Solar Irradiance 
Average Period s Seconds 

GlobalSolarIrradianceSamplesAveraged_Count 
Global Solar Irradiance 
Samples Averaged {Count} Count 

GlobalSolarIrradianceStandardDeviation_Wm2 
Global Solar Irradiance 
Standard Deviation W/m2 MicroSiemens/cm 

NetExposure_Jm2 Net Exposure J/m2 
Joules per square 
metre 

NetExposure95percUncertainty_Jm2 
Net Exposure 95 Percent 
Uncertainty J/m2 

Joules per square 
metre 

NetExposureLengthSampleCount_Count 
Net Exposure Length 
Sample Count {Count} Count 

NetExposurePeriod_s Net Exposure Period s Seconds 

NetIrradiance95PercUncertainty_Wm2 
Net Irradiance 95 Percent 
Uncertainty W/m2 MicroSiemens/cm 

NetIrradianceAverage_Wm2 Net Irradiance Average W/m2 MicroSiemens/cm 

NetIrradianceAveragePeriod_s 
Net Irradiance Average 
Period s Seconds 

NetIrradianceSamplesAveraged_Count 
Net Irradiance Samples 
Averaged {Count} Count 

NetIrradianceStandardDeviation_Wm2 
Net Irradiance Standard 
Deviation W/m2 MicroSiemens/cm 

ReflectedGlobalSolarExposure_Jm2 
Reflected Global Solar 
Exposure J/m2 

Joules per square 
metre 

ReflectedGlobalSolarExposure95PercUncertainty_Jm2 

Reflected Global Solar 
Exposure 95 Percent 
Uncertainty J/m2 

Joules per square 
metre 

ReflectedGlobalSolarExposurePeriod_s 
Reflected Global Solar 
Exposure Period s Seconds 

ReflectedGlobalSolarExposureSampleCount_Count 
Reflected Global Solar 
Exposure Sample Count {Count} Count 

ReflectedGlobalSolarIrradiance95PercUncertainty_Wm2 

Reflected Global Solar 
Irradiance 95 Percent 
Uncertainty W/m2 MicroSiemens/cm 

ReflectedGlobalSolarIrradianceAverage_Wm2 
Reflected Global Solar 
Irradiance Average W/m2 MicroSiemens/cm 

ReflectedGlobalSolarIrradianceAveragePeriod_s 
Reflected Global Solar 
Irradiance Average Period s Seconds 

ReflectedGlobalSolarIrradianceSamplesAveraged_Count 

Reflected Global Solar 
Irradiance Samples 
Averaged {Count} Count 



52 
Copyright © 2014 Open Geospatial Consortium 

ReflectedGlobalSolarIrradianceStandardDeviation_Wm2 

Reflected Global Solar 
Irradiance Standard 
Deviation W/m2 MicroSiemens/cm 

UpwardLongwaveExposure_Jm2 
Upward Longwave 
Exposure J/m2 

Joules per square 
metre 

UpwardLongwaveExposure95PercUncertainty_Jm2 

Upward Longwave 
Exposure 95 Percent 
Uncertainty J/m2 

Joules per square 
metre 

UpwardLongwaveExposurePeriod_s 
Upward Longwave 
Exposure Period s Seconds 

UpwardLongwaveExposureSampleCount_Count 
Upward Longwave 
Exposure Sample Count {Count} Count 

UpwardLongwaveIrradiance95PercUncertainty_Wm2 

Upward Longwave 
Irradiance 95 Percent 
Uncertainty W/m2 MicroSiemens/cm 

UpwardLongwaveIrradianceAverage_Wm2 
Upward Longwave 
Irradiance Average W/m2 MicroSiemens/cm 

UpwardLongwaveIrradianceAveragePeriod_s 
Upward Longwave 
Irradiance Average Period s Seconds 

UpwardLongwaveIrradianceSamplesAveraged_Count 

Upward Longwave 
Irradiance Samples 
Averaged {Count} Count 

UpwardLongwaveIrradianceStandardDeviation_Wm2 

Upward Longwave 
Irradiance Standard 
Deviation W/m2 MicroSiemens/cm 

AquiferRecharge_ML Aquifer Recharge ML Megalitres 

StorageOutflow_MLd Storage Outflow ML/d Megalitres/day 

StorageInflow_MLd Storage Inflow ML/d Megalitres/day 

DewpointTemperature_DegC Dewpoint Temperature Cel Degrees Celsius 

WaterCourseLevel_ft Water course level ft Feet 

WaterCourseDischarge_ft3s Water course discharge ft^3/s Cubic feet/second 

WaterVolume_AF Water volume AF Acre foot 

 

  



53 
Copyright © 2014 Open Geospatial Consortium 

Annex D - Bibliography 

OGC	  WaterML2.0	  part	  1	  –	  timeseries.	  http://www.opengeospatial.org/standards/waterml	  	  

OGC	  Observations	  and	  Measurements	  v2.0	  OGC	  Document	  10-­‐004r1	  
http://www.opengis.net/doc/AS/Topic20	  (also	  published	  as	  ISO	  19156:2010,	  Geographic	  
information	  —	  Observations	  and	  Measurements)	  

A	  REST	  binding	  for	  WFS	  2.0,	  OGC	  document	  11-­‐080.	  Peter	  Vretanos,	  CubeWerx	  Inc.	  2011.	  	  

WMO	  manual	  of	  stream	  gauging	  1044	  Vol	  II.	  
http://www.wmo.int/pages/prog/hwrp/publications/stream_gauging/1044_Vol_II_en.pdf	  

U.S.	  Geological	  Survey,	  Techniques	  of	  Water-­‐Resources	  Investigations,	  Book	  3,	  Chapter	  
A13	  http://pubs.usgs.gov/twri/twri3-­‐a13/	  

USGS	  Stage-­‐Discharge	  Relations-­‐-­‐Basic	  Concepts	  Training	  Class	  
(http://wwwrcamnl.wr.usgs.gov/sws/SWTraining/RatingsWeb/Index.html):	  

Shift	  Procedure:	  
http://wwwrcamnl.wr.usgs.gov/sws/SWTraining/RatingsWeb/Shift_by_stage.proc.p
df	  

Shift	  development:	  
http://wwwrcamnl.wr.usgs.gov/sws/SWTraining/RatingsWeb/RatingShifts/ShiftsDev
elopment.swf	  

COmputation	  of	  continuous	  records	  of	  streamflow:	  

Section	  1	  Abstract,	  Introduction,	  Field	  data	  requirements,	  Datum	  and	  gage-­‐height	  
corrections,	  List	  of	  discharge	  measurements,	  Discharge	  ratings	  	  

Section	  2	  Manual	  computation	  of	  gage-­‐height	  record,	  Computation	  of	  discharge	  
record	  	  

Section	  3	  Computation	  of	  discharge	  record	  (cont'd)	  Station	  analysis,	  Progress	  
documentation,	  Quality	  assurance,	  References	  cited,	  Glossary	  	  

 


